# 本部botのとりあえず動くプロトタイプの設計


## システム構成の概略
・菜南スプシ:GM用のUIとゲーム処理を担う
・R鯖:菜南スプシと繋ぐための本部botのバックエンド
・本部bot:プレイヤー側のUIを担う。バックエンドはR鯖
## 担当範囲の切り分けについて
・ゲーム処理(夜行動,投票,役職の決定)=菜南スプシ
・プレイヤーへの役職配布(discordにて)=R鯖
・夜行動の結果をプレイヤーに渡す(discordにて)=R鯖
・夜行動の結果をGMに渡す=菜南スプシ
・プレイヤーリストの作成(discordの投稿にスタンプを押してもらい、スタンプを押したユーザーのidと表示名を取得)=R鯖

## 菜南スプシとの連携について
R鯖が用意するAPIエンドポイントを菜南スプシ

ゲーム開始前にdiscord上にその日のゲームのカテゴリと、各役職のチャンネル(村人を除く)と投票チャンネル,GMチャンネルを作成する(プライベートチャンネル)
ゲーム開始前にプレイヤーリストの取得を行う(菜南スプシからR鯖を叩き情報を取得する) GETで叩いてjsonが返ってくる
プレイヤーリストとレギュレーションをもとに配役を行う(配役処理は菜南スプシにて行い、その結果をR鯖に伝える)
配役の結果をもとに、各役職のチャンネルに招待を行う(処理はすべてR鯖上で行う)
役職チャンネルに招待を行った後に、該当ユーザーにメンションを飛ばし、リアクションボタンを押してもらう(それぞれのチャンネルについてリアクションがあったかを把握)
投票が行われるたびに菜南スプシに入力→R鯖に送信→1票入るごとに投票チャンネルに投票者と投票先及び投票先の現在の得票数を投げる
その日の処刑者を菜南スプシ側で判定→R鯖に送信
菜南スプシ側で判定を行い、霊媒結果をR鯖に送信→霊媒チャンネルに結果を送信
占い師チャンネルをGMが目視で確認し、菜南スプシに入力→結果の判定を行いR鯖に送信→占い師チャンネルに本部botが結果を投げる
騎士チャンネルと人狼チャンネルをGMが目視で確認し、菜南スプシにそれぞれ入力→襲撃結果を菜南スプシにて判定
翌朝になり、GMが朝の死者を発表

以後繰り返し