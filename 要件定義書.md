# 要件定義書

## 1. 目的
人狼ゲームを配信コミュニティで円滑に進行するため、GMを補助するツールを提供する。
技術者GMが利用可能なライブラリ形式で提供し、さまざまな利用シーンに対応する。

---

## 2. 利用シーン
1. **完全自動進行モード**
   - GM不在でもゲームが進行可能。
   - プレイヤーの行動や結果を自動で処理。

2. **部分補助モード**
   - GMが進行を行い、夜時間の処理や結果管理を補助。
   - 占い、霊能、襲撃の成否などを正確に管理。

3. **カスタムモード**
   - 特定のルールや配役に基づいて柔軟に設定可能。
   - 特殊なレギュレーションや役職にも対応。

---

## 3. 必須要件
### 3.1 基本機能
- **プレイヤー管理**
  - プレイヤーの追加、削除、状態（生存/死亡）の管理。
- **役職管理**
  - 自動/手動での役職割り当て。
  - カスタム役職の追加。
- **フェーズ管理**
  - 昼/夜のフェーズ切り替え。
  - フェーズごとの行動処理。
- **投票管理**
  - 投票の受付、集計、結果表示。
  - 同数票時の処理（例: 決戦投票、ランダム処刑）。
- **勝敗判定**
  - 村人陣営、人狼陣営、狐陣営などの勝敗条件を判定。

### 3.2 柔軟性
- **人数対応**
  - 5人～20人以上のプレイヤーに対応。
- **配役対応**
  - 標準的な16A配役からカスタム配役まで対応。
- **ルール設定**
  - 連続護衛の可否、同数票時の処理戦略などを設定可能。

---

## 4. 拡張要件（アプリケーション側に委譲）
以下の機能はライブラリではなく、アプリケーション側で実装するものとする。
- **Discord連携**
  - Discordのチャットやボイスチャンネルを利用した進行補助。
- **ログ機能**
  - ゲーム進行の履歴を記録。
- **多言語対応**
  - 日本語以外の言語にも対応。
- **AI補助**
  - プレイヤーの行動を分析し、GMにアドバイスを提供。

---

## 5. ライブラリの提供範囲
1. **コアロジックの提供**
   - プレイヤー管理、役職管理、フェーズ管理、投票管理、勝敗判定などの必須機能
2. **柔軟な設定**
   - JSON定義とJSアドオンによるハイブリッドな配役・ルール設定
3. **データ構造の設計**
   - 内部状態は各種データモデル（プレイヤー、役職、フェーズ）に基づいて管理
4. **イベント駆動型設計**
   - 各処理結果をイベントとして発火し、アプリ側でフック可能なAPIを提供

---

## 6. 非機能要件
- **軽量性**
  - 必要最小限の機能に絞り、軽量なライブラリとして提供。
- **拡張性**
  - アプリケーション側での拡張を容易にする設計（例: フックやコールバックの提供）。
- **ドキュメント整備**
  - ライブラリの使い方やAPI仕様を明確に記載したドキュメントを提供。

---

## 7. 優先順位
1. プレイヤー管理、役職管理、フェーズ管理、投票管理、勝敗判定の実装。
2. 柔軟なルール設定とカスタム配役対応。
3. イベント駆動型設計の実装。

---

## 8. アドオン機能
- **新役職の追加**
  - アドオン形式で新しい役職を追加できる仕組みを提供する。
  - 役職の行動や勝敗条件をカスタマイズ可能にする。

### 8.1 必須要件
1. **役職の登録機能**
   - 外部から役職を登録できるAPIを提供。
   - 役職の行動（例: 夜時間の特殊能力）や勝敗条件を定義可能。
2. **役職の依存関係管理**
   - 他の役職やゲームルールとの依存関係を考慮した設計。
   - 例: 背徳者は狐が死亡した場合に自動で死亡。
3. **柔軟な設定**
   - 役職の行動や条件をスクリプト形式で記述可能にする。

### 8.2 非機能要件
- **安全性**
  - アドオンがゲーム進行に悪影響を与えないよう、入力データのバリデーションを実施。
- **拡張性**
  - 将来的に複数のアドオンを同時に利用できる設計。
- **ドキュメント整備**
  - アドオンの作成方法や登録手順を明確に記載したガイドを提供。

### 8.3 優先順位
1. 役職の登録機能の実装。
2. 役職の行動や勝敗条件をスクリプト形式で記述可能にする仕組みの実装。
3. 依存関係管理の実装。

---

## 9. サンプルコード
- **16A配役**
  - 15人村。狼3, 狂人1, 狐1, 占い師1, 霊媒師1, 騎士1, 共有者2, 残りは村人。
  - 役職欠けあり。連続ガードなし、同票時はランダム処刑。

- **13ア式配役**
  - 13人村。狼3, 狂人1, 占い師1, 霊媒師1, 騎士1, 残りは村人。
  - 役職欠けなし。連続ガードなし、同票時は決戦投票、決戦でも同票の場合はランダム処刑。

---

## 10. 備考
- 本要件定義書の各項目は、設計書.mdにおける詳細設計及びAPI仕様で具体化されています。
- 拡張要件、非機能要件については設計書.md内で詳細に議論・設計されているため、実装時の参照資料としてください。