## 1. コマンドの命名規則・プレフィックス

* 各コマンドは、その機能に応じて以下のいずれかのプレフィックスで開始します。
    * `/game_` (ゲーム全体の進行・設定に関するコマンド)
    * `/player_` (プレイヤーの管理や情報に関するコマンド)
    * `/role_` (役職の割り当てや役職固有の操作に関するコマンド)
    * `/vote_` (投票処理に関するコマンド)
* 具体的なコマンド名は、添付のAPI仕様書 (`index.html`) のエンドポイント名を参考にしつつ、Discordコマンドとして適切なものに調整します。
* 関連書類:UIレスbotの設計

## 2. 共通事項

* **実行権限:** 現時点では特別な実行権限は実装しません。将来的には特定のDiscordロールを持つユーザーのみが実行可能とする予定です。
* **エラー時の共通応答形式:** エラーが発生した場合、Botは「GMチャンネル」と名付けられた特定のテキストチャンネルにエラーメッセージを投稿します。メッセージ形式は「エラー: [コマンド名] - [エラー内容詳細]」とします。
    * (補足: 「GMチャンネル」が未作成、またはBotが特定できない場合は、コマンド実行チャンネルにエラーを返すなどのフォールバック処理を検討する必要があります。)
* **コマンドの有効範囲:** 現時点では特に定めません。どのチャンネルで実行されてもBotは応答を試みます。

## 3. コマンド一覧

### コマンド名: `/game_setup`

* **目的・説明:**
    * 新しい人狼ゲームセッションを開始するための初期セットアップを行います。指定されたサーバーにゲーム用のカテゴリ、および基本的なチャンネル（GMチャンネル、全体アナウンスチャンネル、投票チャンネル）を作成します。
* **引数 (オプション):**
    | 引数名       | 型     | 必須/任意 | 説明                                                                              |
    | ------------ | ------ | --------- | --------------------------------------------------------------------------------- |
    | `game_title` | 文字列 | 任意      | 作成されるカテゴリ名。指定しない場合は「人狼ゲーム-[日付]」のようなデフォルト名。 |
* **実行例:**
    * `/game_setup game_title:"ア式13人村"`
    * `/game_setup`
* **Botの応答 (成功時):**
    * 「ゲームセットアップが完了しました。カテゴリ「[カテゴリ名]」内に以下のチャンネルを作成しました。\n GMチャンネル: #[GMチャンネル名]\n アナウンスチャンネル: #[アナウンスチャンネル名]\n 投票チャンネル: #[投票チャンネル名]」
* **Botの応答 (エラー時・失敗時):**
    * 「エラー: 既にアクティブなゲームセッションが存在します。先に `/game_reset` を実行してください。」
    * 「エラー: チャンネルの作成に失敗しました。Botの権限を確認してください。」
* **トリガーされる内部処理 / 備考:**
    * 実行したDiscordサーバーのID (`serverId`) を取得。
    * 指定された `game_title` (またはデフォルト名) でDiscordカテゴリを作成。
    * 作成したカテゴリ内に、GM専用チャンネル、全体アナウンス用チャンネル、投票用チャンネルをテキストチャンネルとして作成。
    * 各チャンネルのIDを `gameSession` オブジェクトに保存。
    * コマンド実行者をGMとして認識（例: `gameSession.gmUserId = interaction.user.id`）。


### コマンド名: `/player_start_recruitment`

* **目的・説明:**
    * 人狼ゲームへの参加者募集を開始します。指定されたアナウンスチャンネル（またはGMが指定したチャンネル）に、参加希望者がリアクションするためのメッセージをBotが投稿します。
* **引数 (オプション):**

    | 引数名           | 型                   | 必須/任意 | 説明                                                                                                                               |
    | ---------------- | -------------------- | --------- | ---------------------------------------------------------------------------------------------------------------------------------- |
    | `channel`        | チャンネルメンション | 任意      | 参加募集メッセージを投稿するチャンネルを指定します。指定しない場合は、`/game_setup` で作成されたアナウンスチャンネルを使用します。 |
    | `message_text`   | 文字列               | 任意      | 募集メッセージの本文をカスタムしたい場合に指定します。デフォルトメッセージも用意されます。                                         |
    | `reaction_emoji` | 文字列 (絵文字)      | 任意      | 参加意思を示すために使用するリアクション絵文字を指定します。デフォルトは `👍` (`:thumbsup:`) です。                                 |

* **実行例:**
    * `/player_start_recruitment`
    * `/player_start_recruitment channel:#general message_text:"今日のア式13人村参加者はこのメッセージにリアクションをお願いします！"`
    * `/player_start_recruitment reaction_emoji:🐺`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「参加者募集を開始しました。#[指定/アナウンスチャンネル名] に募集メッセージを投稿し、[絵文字] でリアクションを受け付けます。募集を締め切るには `/player_finalize_list` コマンドを実行してください。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/player_start_recruitment` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/player_start_recruitment` - 指定されたチャンネルが見つかりません、またはBotにメッセージを送信する権限がありません。」
    * (GMチャンネルへ) 「エラー: `/player_start_recruitment` - 既に別の参加者募集が進行中です。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか（`/game_setup` が実行済みか）を確認。
    * 指定されたチャンネル（またはデフォルトのアナウンスチャンネル）に募集メッセージを投稿。
        * デフォルトメッセージ例: 「人狼ゲームの参加者を募集します！参加希望の方はこのメッセージに [絵文字] でリアクションしてください。」
    * 投稿したメッセージのID (`playerListMessageId`) とチャンネルID (`playerListMessageChannelId`) を `gameSession` に保存。
    * 使用するリアクション絵文字も `gameSession` に保存 (`gameSession.reactionEmoji`)。
    * このコマンド自体はプレイヤーリストをまだ確定しません。リストの確定は別のコマンド (`/player_finalize_list` など) で行います。


### コマンド名: `/player_finalize_list`

* **目的・説明:**
    * `/player_start_recruitment` で開始した参加者募集を締め切り、指定されたメッセージへのリアクションを元に最終的なプレイヤーリストを作成・確定します。確定したプレイヤーリストはGMチャンネルに表示されます。
* **引数 (オプション):**
    * なし (募集中のメッセージは `gameSession` から取得します)
* **実行例:**
    * `/player_finalize_list`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「参加者募集を締め切りました。現在のプレイヤーリストは以下の通りです (計 N名):\n1. @ユーザーA (ユーザーID: xxxxxxxxxxxxxxxxxx)\n2. @ユーザーB (ユーザーID: yyyyyyyyyyyyyyyyyy)\n   ...\n次に `/role_assign` コマンドで配役を行ってください。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/player_finalize_list` - 参加者募集が開始されていません。先に `/player_start_recruitment` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/player_finalize_list` - 募集メッセージが見つかりませんでした。再度募集を開始するか、Botの権限を確認してください。」
    * (GMチャンネルへ) 「エラー: `/player_finalize_list` - リアクションの取得に失敗しました。」
    * (GMチャンネルへ) 「エラー: `/player_finalize_list` - 参加者が0名です。ゲームを開始できません。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` に保存されている `playerListMessageId` と `playerListMessageChannelId`、`reactionEmoji` を使用して、対象のメッセージからリアクションしたユーザーのリストを取得します。
        * Bot自身のリアクションは除外します。
        * 複数のリアクションがあっても、1ユーザーにつき1参加としてカウントします（重複排除）。
    * 取得したユーザーのDiscordユーザーIDと表示名を `gameSession.players` 配列に保存します。
        * 例: `gameSession.players = [{id: "xxxxxxxxxx", displayName: "ユーザーA", roles: []}, {id: "yyyyyyyyyy", displayName: "ユーザーB", roles: []}]`
    * プレイヤーリストが確定したことを示すフラグを `gameSession` に設定する (例: `gameSession.playerListFinalized = true`)。


### コマンド名: `/player_add`

* **目的・説明:**
    * プレイヤーリストに指定したDiscordユーザーを手動で追加します。リアクションでの参加が漏れたユーザーや、GMが直接参加させたいユーザーを追加する場合に使用します。このコマンドは、`/player_finalize_list` でプレイヤーリストのベースが作成された後に使用可能です。
* **引数 (オプション):**
    | 引数名 | 型                 | 必須/任意 | 説明                                        |
    | ------ | ------------------ | --------- | ------------------------------------------- |
    | `user` | ユーザーメンション | 必須      | プレイヤーリストに追加するDiscordユーザー。 |
* **実行例:**
    * `/player_add user:@追加したいユーザー`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「@ユーザー名 さんをプレイヤーリストに追加しました。現在のプレイヤーリストは `/player_show_list` で確認できます。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/player_add` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/player_add` - プレイヤーリストがまだ確定されていません。先に `/player_finalize_list` を実行して、リアクションベースの参加者リストを作成してください。」
    * (GMチャンネルへ) 「エラー: `/player_add` - 指定されたユーザーが見つかりません。」
    * (GMチャンネルへ) 「エラー: `/player_add` - @ユーザー名 さんは既にプレイヤーリストに存在します。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、かつ `gameSession.playerListFinalized` が `true` であることを確認。
    * 指定されたユーザーが既に `gameSession.players` 配列にいないか確認。
    * `gameSession.players` 配列に指定されたユーザーのDiscordユーザーIDと表示名を追加します。
        * 例: `gameSession.players.push({id: "zzzzzzzzzz", displayName: "手動追加ユーザー", roles: []})`

---

### コマンド名: `/player_remove`

* **目的・説明:**
    * プレイヤーリストから指定したDiscordユーザーを手動で削除します。誤って参加したユーザーや、GMが参加を取り消したいユーザーを削除する場合に使用します。このコマンドは、`/player_finalize_list` でプレイヤーリストのベースが作成された後に使用可能です。
* **引数 (オプション):**
    | 引数名 | 型                 | 必須/任意 | 説明                                          |
    | ------ | ------------------ | --------- | --------------------------------------------- |
    | `user` | ユーザーメンション | 必須      | プレイヤーリストから削除するDiscordユーザー。 |
* **実行例:**
    * `/player_remove user:@削除したいユーザー`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「@ユーザー名 さんをプレイヤーリストから削除しました。現在のプレイヤーリストは `/player_show_list` で確認できます。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/player_remove` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/player_remove` - プレイヤーリストがまだ確定されていません。先に `/player_finalize_list` を実行して、リアクションベースの参加者リストを作成してください。」
    * (GMチャンネルへ) 「エラー: `/player_remove` - 指定されたユーザーが見つかりません。」
    * (GMチャンネルへ) 「エラー: `/player_remove` - @ユーザー名 さんはプレイヤーリストに存在しません。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、かつ `gameSession.playerListFinalized` が `true` であることを確認。
    * 指定されたユーザーが `gameSession.players` 配列に存在するか確認。
    * `gameSession.players` 配列から指定されたユーザーを削除します。

---

### コマンド名: `/player_show_list`

* **目的・説明:**
    * 現在のプレイヤーリストをGMチャンネルに表示します。参加者募集の締め切り後や、手動での追加・削除後にリストを確認するために使用します。
* **引数 (オプション):**
    * なし
* **実行例:**
    * `/player_show_list`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「現在のプレイヤーリスト (計 N名):\n1. @ユーザーA (ユーザーID: xxxxxxxxxxxxxxxxxx)\n2. @ユーザーB (ユーザーID: yyyyyyyyyyyyyyyyyy)\n   ...」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/player_show_list` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/player_show_list` - プレイヤーリストがまだ作成されていません。`/player_start_recruitment` および `/player_finalize_list` を実行してください。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、かつプレイヤーリストが初期化されているか（例: `gameSession.players` が存在する）を確認。
    * `gameSession.players` 配列の内容を整形してGMチャンネルに送信します。


### コマンド名: `/role_assign`

* **目的・説明:**
    * 確定したプレイヤーリストに基づき、アルティメット人狼13人村の役職構成に従って各プレイヤーに役職をランダムに割り当てます。役職を持つプレイヤー（村人を除く）には各役職チャンネルの最初のメッセージでメンションにて通知し、必要な役職チャンネルが作成・招待されます。村人にはBotからの直接的な役職通知は行いません。また、占い師には役職通知と同時に初日占いの結果が通知されます。
* **引数 (オプション):**
    * なし
* **実行例:**
    * `/role_assign`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「配役が完了しました。各プレイヤーに役職を通知し、役職チャンネルへの招待を行いました（村人を除く）。占い師には初日占いの結果も通知済みです。役職者からの反応を確認次第、 `/game_start_first_night`を行なってください」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/role_assign` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/role_assign` - プレイヤーリストが確定されていません。先に `/player_finalize_list` を実行し、必要であれば `/player_add` や `/player_remove` で調整してください。」
    * (GMチャンネルへ) 「エラー: `/role_assign` - プレイヤー数が13人ではありません。アルティメット人狼13人村のプロトタイプでは、プレイヤー数を13人に調整してください。」
    * (GMチャンネルへ) 「エラー: `/role_assign` - 役職チャンネルの作成、招待、または通知メッセージの送信中にエラーが発生しました。詳細はBotのログを確認してください。」
    * (GMチャンネルへ) 「エラー: `/role_assign` - 配役処理中に予期せぬエラーが発生しました。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、かつ `gameSession.playerListFinalized` が `true` であることを確認。
    * `gameSession.players` の数が13人であることを確認（プロトタイプ固定）。
    * **役職構成（ア式13人村固定）:**
        * 人狼: 3名
        * 狂人: 1名
        * 占い師: 1名
        * 霊媒師: 1名
        * 狩人: 1名
        * 村人: 6名
    * **配役処理:**
        1.  `gameSession.players` リストをシャッフルする。
        2.  シャッフルされたリストの先頭から順に上記の役職を割り当てる。
        3.  割り当てた役職情報を `gameSession.players[i].role` のような形で保存する。
    * **役職チャンネル作成と招待:**
        * `gameSession.categoryId` の配下に、以下の役職専用プライベートチャンネルを作成する。
            * `人狼チャンネル` (人狼3名を招待)
            * `狂人チャンネル` (狂人1名を招待)
            * `占い師チャンネル` (占い師1名を招待)
            * `霊媒師チャンネル` (霊媒師1名を招待)
            * `狩人チャンネル` (狩人1名を招待)
        * 村人には専用チャンネルは作成しない。
        * 各チャンネルのパーミッションを設定し、該当役職のプレイヤーとGMのみが閲覧・発言できるようにする。
        * 作成したチャンネルIDを `gameSession.channels.roles` のような形で保存。
    * **役職通知 (村人を除く):**
        * **初日占い対象選定 (占い師通知用):**
            1.  全プレイヤーのリスト (`gameSession.players`) から、「人狼」ロールのプレイヤーと「占い師」ロールのプレイヤー本人を除いたリストを作成する。
            2.  上記リストからランダムに1名を選出する（これが「白」となる対象）。このプレイヤーのDiscord表示名（`displayName`）を取得しておく。
        * **人狼:** `人狼チャンネル` の最初のメッセージとして、「@人狼プレイヤー1 さん, @人狼プレイヤー2 さん, @人狼プレイヤー3 さん、あなたたちは【人狼】です。仲間の人狼はここにいるメンバーです。このチャンネルで相談してください。」と投稿。
        * **狂人:** `狂人チャンネル` の最初のメッセージとして、「@狂人プレイヤー さん、あなたは【狂人】です。人狼陣営の勝利のために行動してください。」と投稿。
        * **占い師:** `占い師チャンネル` の最初のメッセージとして、「@占い師プレイヤー さん、あなたの役職は【占い師】です。あなたは **[初日占い対象の表示名]** さんが【人間】であることを知っています。」と投稿。（例: 「あなたは おおかみたろう さんが【人間】であることを知っています。」）
        * **霊媒師:** `霊媒師チャンネル` の最初のメッセージとして、「@霊媒師プレイヤー さん、あなたの役職は【霊媒師】です。」と投稿。
        * **狩人:** `狩人チャンネル` の最初のメッセージとして、「@狩人プレイヤー さん、あなたの役職は【狩人】です。」と投稿。
    * **村人の扱い:** Botからの直接的な役職通知は行わない。GMは、役職チャンネルに招待されていないプレイヤーが村人であると把握する。プレイヤー自身も、どの役職チャンネルにも招待されなければ自分が村人であると認識する。
    * 配役が完了したことを示すフラグを `gameSession` に設定 (例: `gameSession.rolesAssigned = true`)。

### コマンド名: `/game_start_first_night`

* **目的・説明:**
    * 配役完了後、GMがこのコマンドを実行することでゲームを開始し、「初夜」フェーズへ移行します。各役職（特に人狼、狩人）が行動を検討する期間となります。プロトタイプではタイマーは動作しません。
* **引数 (オプション):**
    * なし
* **実行例:**
    * `/game_start_first_night`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「ゲームを開始し、初夜フェーズへ移行しました。各役職は行動を検討してください。GMは適宜議論を開始し、最初の処刑者を決定したら `/vote_result` コマンドで処刑者を記録してください。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/game_start_first_night` - ゲームがセットアップされていません。先に `/game_setup` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/game_start_first_night` - プレイヤーリストが確定されていません。先に `/player_finalize_list` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/game_start_first_night` - 配役が完了していません。先に `/role_assign` を実行してください。」
    * (GMチャンネルへ) 「エラー: `/game_start_first_night` - ゲームは既に開始されています。現在のフェーズ: [現在のフェーズ名]」 (※`gameSession.currentPhase` は内部的な状態管理として残す想定)
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、`playerListFinalized` が `true` か、`rolesAssigned` が `true` かを確認。
    * GMチャンネルにメッセージを投稿。
    * ア式では初夜に襲撃は発生しません。このフェーズは、GMが昼の議論を開始するまでの準備期間となります。


### コマンド名: `/vote_result`

* **目的・説明:**
    * 昼の議論の結果、決定した処刑者をBotに記録します。指定されたプレイヤーは「死亡」状態となります。処理の最後に、自動的に勝利条件が判定されます。
* **引数 (オプション):**
    | 引数名 | 型                 | 必須/任意 | 説明                               |
    | ------ | ------------------ | --------- | ---------------------------------- |
    | `user` | ユーザーメンション | 必須      | 処刑されるプレイヤーを指定します。 |
* **実行例:**
    * `/vote_result user:@処刑されるプレイヤー`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「@処刑されたプレイヤー さんが処刑されました。」
    * (勝利判定の結果、ゲームが終了した場合、追加で以下のメッセージをGMチャンネルへ投稿)
        * 「**ゲーム終了！ [勝利陣営] の勝利です！**」
    * (勝利判定の結果、ゲームが続く場合、追加で以下のメッセージをGMチャンネルへ投稿)
        * 「ゲームは継続します。夜フェーズへの移行 (`/game_progress_to_night` )を行ってください。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/vote_result` - ゲームが開始されていません。」
    * (GMチャンネルへ) 「エラー: `/vote_result` - 配役が完了していません。」
    * (GMチャンネルへ) 「エラー: `/vote_result` - 指定されたユーザーが見つかりません、またはプレイヤーリストに存在しません。」
    * (GMチャンネルへ) 「エラー: `/vote_result` - @ユーザー名 さんは既に死亡しています。」
    * (GMチャンネルへ) 「エラー: `/vote_result` - 現在のフェーズでは処刑を行えません。」 (※ `gameSession.currentPhase` が `DAY` であることなどを確認する場合)
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、配役が完了しているかを確認。
    * 指定された `user` が `gameSession.players` に存在し、かつ生存している (`isAlive !== false`)ことを確認。
    * `gameSession.players` 内の該当プレイヤーの `isAlive` プロパティを `false` に更新。
    * 直近の処刑者情報を `gameSession.lastExecutedUser` に保存 (霊媒結果コマンド用)。
        * `gameSession.lastExecutedUser = { userId: "処刑されたユーザーID", role: "処刑されたユーザーの役職", displayName: "処刑されたユーザーの表示名" }`
    * GMチャンネルに処刑結果を通知。
    * **勝利判定ロジックを呼び出す:**
        * 「勝利判定ロジック」を実行。
        * 結果に応じて、`gameSession.winningFaction` を更新し、GMチャンネルに追加の通知を行う。
        * ゲームが終了した場合、`gameSession.gameEnded = true` のようなフラグを設定。
    * **このコマンドでは霊媒結果の通知やフェーズ移行は直接行いません（GMへの指示メッセージに含めるのみ）。**

### コマンド名: `/night_phase`

* **目的・説明:**
    * ゲームを「2日目以降の夜」フェーズへ移行させます。このコマンドは最初の処刑が行われた後に使用します。移行時に、霊媒師チャンネルへ直近の処刑者の役職結果を通知します。
* **引数 (オプション):**
    * なし
* **実行例:**
    * `/night_phase`
* **Botの応答 (成功時):**
    * (GMチャンネルへ) 「夜時間へ移行しました。霊媒結果を霊媒師チャンネルに通知しました。各役職は夜の行動を行ってください。行動指示は `/night_wolf`, `/night_guard`, `/night_seer` コマンドを使用してください。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/night_phase` - ゲームが開始されていません。」
    * (GMチャンネルへ) 「エラー: `/night_phase` - 配役が完了していません。」
    * (GMチャンネルへ) 「エラー: `/night_phase` - まだ最初の処刑が行われていません。このコマンドは2日目以降の夜に使用します。」 (※`gameSession.lastExecutedUser` が未設定の場合)
    * (GMチャンネルへ) 「エラー: `/night_phase` - 現在のフェーズでは夜へ移行できません。」 (例: 既に夜フェーズである場合など)
    * (GMチャンネルへ) 「エラー: `/night_phase` - 霊媒師が見つからないか、霊媒師チャンネルが設定されていません。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession` がアクティブか、配役が完了しているかを確認。
    * `gameSession.lastExecutedUser` が設定されている（＝最初の処刑が完了している）ことを確認。
    * **霊媒結果通知:**
        1.  `gameSession.lastExecutedUser` から直近の処刑者の情報（表示名、役職）を取得。
        2.  霊媒師 (`gameSession.players` から `role === "霊媒師"` の生存プレイヤーを探す) が存在し、生存している場合、その霊媒師の役職チャンネル (`霊媒師チャンネル`) に「@霊媒師プレイヤー さん、昨夜処刑された [処刑者の表示名] さん の役職は【[処刑者の役職]】でした。」と投稿する。
    * GMチャンネルに夜時間への移行メッセージを投稿し、夜の行動コマンドを案内する。

### コマンド名: `/night_seer`

* **目的・説明:**
    * 占い師が指定したプレイヤーを占い、その結果（人間か人狼か）を占い師の役職チャンネルに通知します。このコマンドは夜時間中にGMが占い師に代わって実行します。
* **引数 (オプション):**
    | 引数名 | 型                 | 必須/任意 | 説明                               |
    | ------ | ------------------ | --------- | ---------------------------------- |
    | `user` | ユーザーメンション | 必須      | 占う対象のプレイヤーを指定します。 |
* **実行例:**
    * `/night_seer user:@占いたいプレイヤー`
* **Botの応答 (成功時):**
    * (占い師チャンネルへ) 「@占い師プレイヤー さん、@対象プレイヤー さんを占った結果、【[人間/人狼]】でした。」
    * (GMチャンネルへ) 「占い師の行動が完了しました。結果を占い師チャンネルに通知しました。」
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/night_seer` - ゲームが夜時間ではありません。」
    * (GMチャンネルへ) 「エラー: `/night_seer` - 占い師が生存していないか、見つかりません。」
    * (GMチャンネルへ) 「エラー: `/night_seer` - 指定された対象プレイヤーが見つかりません、または既に死亡しています。」
    * (GMチャンネルへ) 「エラー: `/night_seer` - 占い師は自分自身を占えません。」
* **トリガーされる内部処理 / 備考:**
    * `gameSession.players` から生存している占い師（`role === "占い師"` かつ `isAlive === true`）を取得。
    * 指定された `user` （占い対象）が生存していることを確認。
    * 占い師が自分自身を占おうとしていないか確認（ルールによる）。
    * 占い対象のプレイヤーの役職 (`role`) を参照し、それが人狼 (`"人狼"`) かどうかで結果を判断。狂人は「人間」として判定されます。
    * 占い師チャンネルに占い結果をメンション付きで投稿。
    * GMチャンネルに行動完了を通知。
    * `gameSession` に占い結果を記録しておく（例: `gameSession.seeresults.push({ day: gameSession.dayCount, seerId: "占い師ID", targetId: "対象ID", result: "人間/人狼" })`。日数カウント不要なら `day` は省略または連番）。
    * **このコマンドは襲撃・護衛の結果処理や勝利判定はトリガーしません。**


### コマンド名: `/night_wolf`

* **目的・説明:**
    * 人狼が襲撃する対象を指定します。このコマンドは夜時間中にGMが人狼に代わって実行します。狩人の護衛対象が既に指定されている場合は、襲撃結果処理ロジックが自動的に呼び出されます。
* **引数 (オプション):**

    | 引数名 | 型                 | 必須/任意 | 説明                                   |
    | ------ | ------------------ | --------- | -------------------------------------- |
    | `user` | ユーザーメンション | 必須      | 襲撃する対象のプレイヤーを指定します。 |
* **実行例:**
    * `/night_wolf user:@襲撃したいプレイヤー`
* **Botの応答 (成功時):**
    * (人狼チャンネルへ) 「@襲撃対象プレイヤー さんを襲撃対象としました。」
    * (GMチャンネルへ) 「人狼の襲撃対象を記録しました。狩人の行動がまだの場合は、続けて `/night_guard` を実行してください。」
    * （狩人の行動も完了しており、襲撃結果処理に進んだ場合は、その結果がGMチャンネルに追加で通知される）
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/night_wolf` - ゲームが夜時間ではありません。」
    * (GMチャンネルへ) 「エラー: `/night_wolf` - 生存している人狼がいません。」
    * (GMチャンネルへ) 「エラー: `/night_wolf` - 指定された対象プレイヤーが見つかりません、または既に死亡しています。」
    * (GMチャンネルへ) 「エラー: `/night_wolf` - 人狼（または狂人など同陣営）を襲撃できません。」
    * (GMチャンネルへ) 「エラー: `/night_wolf` - 今夜の襲撃対象は既に指定済みです。」
* **トリガーされる内部処理 / 備考:**
    * 生存している人狼がいることを確認。
    * 襲撃対象が生存しており、かつ襲撃可能な対象（例: 人狼以外のプレイヤー）であることを確認。
    * 襲撃対象者の情報を `gameSession.wolfAttackTarget = { userId: user.id, displayName: user.displayName }` として保存。
    * 人狼チャンネルとGMチャンネルに通知。
    * **襲撃結果処理のトリガーチェック:**
        * `gameSession.guardTarget` (狩人の護衛対象) が既に設定されているか確認。
        * 設定されていれば、「襲撃結果処理ロジック」を呼び出す。


### コマンド名: `/night_guard`

* **目的・説明:**
    * 狩人が護衛する対象を指定します。このコマンドは夜時間中にGMが狩人に代わって実行します。人狼の襲撃対象が既に指定されている場合は、襲撃結果処理ロジックが自動的に呼び出されます。
* **引数 (オプション):**

    | 引数名 | 型                 | 必須/任意 | 説明                                   |
    | ------ | ------------------ | --------- | -------------------------------------- |
    | `user` | ユーザーメンション | 必須      | 護衛する対象のプレイヤーを指定します。 |
* **実行例:**
    * `/night_guard user:@護衛したいプレイヤー`
* **Botの応答 (成功時):**
    * (狩人チャンネルへ) 「@護衛対象プレイヤー さんを護衛対象としました。」
    * (GMチャンネルへ) 「狩人の護衛対象を記録しました。人狼の行動がまだの場合は、続けて `/night_wolf` を実行してください。」
    * （人狼の行動も完了しており、襲撃結果処理に進んだ場合は、その結果がGMチャンネルに追加で通知される）
* **Botの応答 (エラー時・失敗時):**
    * (GMチャンネルへ) 「エラー: `/night_guard` - ゲームが夜時間ではありません。」
    * (GMチャンネルへ) 「エラー: `/night_guard` - 狩人が生存していないか、見つかりません。」
    * (GMチャンネルへ) 「エラー: `/night_guard` - 指定された対象プレイヤーが見つかりません、または既に死亡しています。」
    * (GMチャンネルへ) 「エラー: `/night_guard` - 今夜の護衛対象は既に指定済みです。」
    * (GMチャンネルへ) 「エラー: `/night_guard` - 前日に護衛した対象を連続して護衛できません。」（※連続ガード不可ルールの場合）
* **トリガーされる内部処理 / 備考:**
    * 生存している狩人がいることを確認。
    * 護衛対象が生存していることを確認。
    * （※連続ガード不可ルールの場合: `gameSession.lastNightGuardTarget` と比較し、連続ガードでないか確認。）
    * 護衛対象者の情報を `gameSession.guardTarget = { userId: user.id, displayName: user.displayName }` として保存。
    * 狩人チャンネルとGMチャンネルに通知。
    * **襲撃結果処理のトリガーチェック:**
        * `gameSession.wolfAttackTarget` (人狼の襲撃対象) が既に設定されているか確認。
        * 設定されていれば、「襲撃結果処理ロジック」を呼び出す。

---

### 襲撃結果処理ロジック (内部関数)

* **呼び出しタイミング:**
    * `/night_wolf` 実行時に `gameSession.guardTarget` が設定済みの場合。
    * `/night_guard` 実行時に `gameSession.wolfAttackTarget` が設定済みの場合。
* **前提:**
    * `gameSession.wolfAttackTarget` と `gameSession.guardTarget` の両方が設定されている。
* **処理フロー:**
    1.  **襲撃成否判定:**
        * `gameSession.wolfAttackTarget.userId` と `gameSession.guardTarget.userId` を比較。
        * **護衛成功の場合:**
            * `gameSession.attackSuccessful = false` と記録。
            * (GMチャンネルへ) 「今夜の襲撃は狩人によって阻止されました。死亡者はいません。」と通知。
        * **護衛失敗の場合:**
            * `gameSession.attackSuccessful = true` と記録。
            * 襲撃対象プレイヤー (`gameSession.players` 内の該当者) の `isAlive` を `false` に更新。
            * (GMチャンネルへ) 「今夜の襲撃により、@襲撃対象プレイヤー さん ([襲撃対象の役職]) が死亡しました。」と通知。
    2.  **夜行動対象情報をクリア:**
        * `gameSession.lastNightGuardTarget = gameSession.guardTarget` （クリア前に、次回の連続ガードチェック用に保存）
        * `gameSession.wolfAttackTarget = null`
        * `gameSession.guardTarget = null`
    3.  **勝利判定ロジックを呼び出す:**
        * 現在の生存者リストで勝利判定を行う。
        * (GMチャンネルへ) 結果に応じて「**ゲーム終了！ [勝利陣営] の勝利です！**」または「ゲームは継続します。」と通知。